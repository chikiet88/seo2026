<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KPI SEO 2026 - Gantt Chi Tiáº¿t</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="data.js"></script>
  <script src="gantt-tasks.js"></script>
  <style>
    .card{background:#fff;border-radius:10px;padding:16px;box-shadow:0 2px 15px rgba(0,0,0,.08)}
    .task-row{display:grid;grid-template-columns:80px 90px 1fr 80px 70px;gap:8px;padding:8px;border-bottom:1px solid #e2e8f0;font-size:12px;align-items:center}
    .task-row:hover{background:#f1f5f9}
    .week-header{background:linear-gradient(135deg,#1e40af,#3b82f6);color:#fff;padding:10px;border-radius:8px;margin:12px 0 8px}
    .site-badge{padding:2px 8px;border-radius:12px;font-size:10px;font-weight:600;color:#fff}
    .type-badge{padding:2px 6px;border-radius:4px;font-size:10px}
    .priority-dot{width:8px;height:8px;border-radius:50%;display:inline-block}
    .tab-btn{padding:8px 16px;border-radius:6px;cursor:pointer;font-size:13px;border:none}
    .tab-btn.active{background:#1e40af;color:#fff}
    .tab-btn:not(.active){background:#e2e8f0;color:#64748b}
    .view-btn{padding:6px 12px;border-radius:4px;font-size:11px;cursor:pointer;border:1px solid #e2e8f0}
    .view-btn.active{background:#1e40af;color:#fff;border-color:#1e40af}
    .filter-btn{padding:4px 10px;border-radius:12px;font-size:10px;cursor:pointer;border:1px solid #e2e8f0}
    .filter-btn.active{background:#3b82f6;color:#fff;border-color:#3b82f6}
    .day-cell{padding:4px;text-align:center;font-size:10px;border:1px solid #e2e8f0;min-height:60px}
    .day-task{padding:2px 4px;margin:1px 0;border-radius:3px;font-size:9px;color:#fff;cursor:pointer}
  </style>
</head>
<body class="bg-gradient-to-br from-slate-100 to-blue-50 min-h-screen font-sans">
<div class="max-w-full mx-auto px-3 py-4">
  
  <header class="text-center mb-4">
    <h1 class="text-2xl font-bold text-blue-800 mb-1">ğŸ“… Gantt Chart Chi Tiáº¿t - SEO 2026</h1>
    <p class="text-gray-600 text-sm">Cháº¿ Ä‘á»™ xem: QuÃ½ / Tuáº§n / NgÃ y | Filter theo Website & Task Type</p>
  </header>

  <!-- Controls -->
  <div class="card mb-4">
    <div class="flex flex-wrap items-center gap-3 mb-3">
      <span class="font-semibold text-sm">ğŸ“Š Cháº¿ Ä‘á»™ xem:</span>
      <button class="view-btn active" onclick="setView('week')">ğŸ“… Tuáº§n</button>
      <button class="view-btn" onclick="setView('day')">ğŸ“† NgÃ y</button>
      <button class="view-btn" onclick="setView('list')">ğŸ“‹ Danh sÃ¡ch</button>
      <span class="mx-2">|</span>
      <button onclick="exportGanttExcel()" class="bg-green-500 hover:bg-green-600 text-white py-1.5 px-4 rounded text-sm">ğŸ“¥ Export Excel</button>
    </div>
    <div class="flex flex-wrap items-center gap-2 mb-3">
      <span class="font-semibold text-sm">ğŸ¢ Website:</span>
      <button class="filter-btn active" data-site="ALL" onclick="toggleSite('ALL')">Táº¥t cáº£</button>
      <button class="filter-btn" data-site="Clinic" onclick="toggleSite('Clinic')">ğŸ¥ Clinic</button>
      <button class="filter-btn" data-site="Timona" onclick="toggleSite('Timona')">ğŸ“ Timona</button>
      <button class="filter-btn" data-site="Hderma" onclick="toggleSite('Hderma')">ğŸ’Š Hderma</button>
      <button class="filter-btn" data-site="Elasome" onclick="toggleSite('Elasome')">ğŸ§¬ Elasome</button>
      <button class="filter-btn" data-site="Group" onclick="toggleSite('Group')">ğŸ¢ Group</button>
    </div>
    <div class="flex flex-wrap items-center gap-2">
      <span class="font-semibold text-sm">ğŸ·ï¸ Loáº¡i task:</span>
      <button class="filter-btn active" data-type="all" onclick="toggleType('all')">Táº¥t cáº£</button>
      <button class="filter-btn" data-type="content" onclick="toggleType('content')">ğŸ“ Content</button>
      <button class="filter-btn" data-type="campaign" onclick="toggleType('campaign')">ğŸš€ Campaign</button>
      <button class="filter-btn" data-type="ai" onclick="toggleType('ai')">ğŸ¤– AI/SEO</button>
      <button class="filter-btn" data-type="technical" onclick="toggleType('technical')">âš™ï¸ Technical</button>
      <button class="filter-btn" data-type="report" onclick="toggleType('report')">ğŸ“Š Report</button>
    </div>
  </div>

  <!-- Quarter Tabs -->
  <div class="flex flex-wrap gap-1 mb-0">
    <button class="tab-btn active" onclick="showQuarter('q1')">Q1 (T1-T3)</button>
    <button class="tab-btn" onclick="showQuarter('q2')">Q2 (T4-T6)</button>
    <button class="tab-btn" onclick="showQuarter('q3')">Q3 (T7-T9)</button>
    <button class="tab-btn" onclick="showQuarter('q4')">Q4 (T10-T12)</button>
    <button class="tab-btn" onclick="showQuarter('all')">ğŸ“‹ Cáº£ nÄƒm</button>
  </div>

  <!-- Main Content -->
  <div id="ganttContent" class="card" style="border-radius:0 10px 10px 10px;max-height:70vh;overflow-y:auto"></div>

  <!-- Legend -->
  <div class="card mt-4">
    <h3 class="font-semibold text-sm mb-2">ğŸ“Œ ChÃº thÃ­ch</h3>
    <div class="flex flex-wrap gap-3 text-xs">
      <div class="flex items-center gap-1"><span class="priority-dot" style="background:#dc2626"></span> Critical</div>
      <div class="flex items-center gap-1"><span class="priority-dot" style="background:#f59e0b"></span> High</div>
      <div class="flex items-center gap-1"><span class="priority-dot" style="background:#3b82f6"></span> Medium</div>
      <div class="flex items-center gap-1"><span class="priority-dot" style="background:#10b981"></span> Low</div>
      <span class="mx-2">|</span>
      <div class="flex items-center gap-1"><span class="type-badge" style="background:#3b82f6;color:#fff">Content</span></div>
      <div class="flex items-center gap-1"><span class="type-badge" style="background:#10b981;color:#fff">Campaign</span></div>
      <div class="flex items-center gap-1"><span class="type-badge" style="background:#f59e0b;color:#fff">AI/SEO</span></div>
      <div class="flex items-center gap-1"><span class="type-badge" style="background:#8b5cf6;color:#fff">Technical</span></div>
    </div>
  </div>

  <footer class="text-center text-gray-500 mt-4 pb-4 text-xs">
    <a href="kpi-full.html" class="text-blue-600 hover:underline">â† Quay láº¡i Dashboard KPI</a> | Gantt Chi Tiáº¿t 2026
  </footer>
</div>

<script>
const SITE_COLORS = {
  ALL: '#1e40af', Clinic: '#dc2626', Timona: '#1e40af', 
  Hderma: '#059669', Elasome: '#7c3aed', Group: '#64748b'
};
const SITE_ICONS = {
  ALL: 'ğŸ“Š', Clinic: 'ğŸ¥', Timona: 'ğŸ“', 
  Hderma: 'ğŸ’Š', Elasome: 'ğŸ§¬', Group: 'ğŸ¢'
};

let currentQuarter = 'q1';
let currentView = 'week';
let activeSites = ['ALL'];
let activeTypes = ['all'];

function showQuarter(q) {
  currentQuarter = q;
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  render();
}

function setView(v) {
  currentView = v;
  document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  render();
}

function toggleSite(site) {
  if (site === 'ALL') {
    activeSites = ['ALL'];
  } else {
    activeSites = activeSites.filter(s => s !== 'ALL');
    if (activeSites.includes(site)) {
      activeSites = activeSites.filter(s => s !== site);
      if (activeSites.length === 0) activeSites = ['ALL'];
    } else {
      activeSites.push(site);
    }
  }
  document.querySelectorAll('[data-site]').forEach(b => {
    b.classList.toggle('active', activeSites.includes(b.dataset.site));
  });
  render();
}

function toggleType(type) {
  if (type === 'all') {
    activeTypes = ['all'];
  } else {
    activeTypes = activeTypes.filter(t => t !== 'all');
    if (activeTypes.includes(type)) {
      activeTypes = activeTypes.filter(t => t !== type);
      if (activeTypes.length === 0) activeTypes = ['all'];
    } else {
      activeTypes.push(type);
    }
  }
  document.querySelectorAll('[data-type]').forEach(b => {
    b.classList.toggle('active', activeTypes.includes(b.dataset.type));
  });
  render();
}

function filterTasks(tasks) {
  return tasks.filter(t => {
    const siteMatch = activeSites.includes('ALL') || activeSites.includes(t.site);
    const typeMatch = activeTypes.includes('all') || activeTypes.includes(t.type);
    return siteMatch && typeMatch;
  });
}

function renderWeekView(quarters) {
  let html = '';
  quarters.forEach(qKey => {
    const q = GANTT_TASKS[qKey];
    if (!q) return;
    html += `<h2 class="text-lg font-bold text-blue-800 mt-4 mb-2">${q.name}</h2>`;
    
    q.weeks.forEach(week => {
      const tasks = filterTasks(week.tasks);
      if (tasks.length === 0) return;
      
      html += `<div class="week-header">
        <span class="font-bold">${week.week}</span> | ${week.start} â†’ ${week.end}
        <span class="float-right text-xs opacity-80">${tasks.length} tasks</span>
      </div>`;
      
      html += `<div class="task-row font-semibold text-xs bg-gray-100">
        <div>Website</div><div>Loáº¡i</div><div>Task</div><div>Priority</div><div>NgÃ y</div>
      </div>`;
      
      tasks.forEach(t => {
        const typeInfo = TASK_TYPES[t.type] || { color: '#64748b', label: t.type };
        const prioInfo = PRIORITIES[t.priority] || { color: '#64748b' };
        html += `<div class="task-row">
          <div><span class="site-badge" style="background:${SITE_COLORS[t.site]}">${SITE_ICONS[t.site]} ${t.site}</span></div>
          <div><span class="type-badge" style="background:${typeInfo.color};color:#fff">${typeInfo.label}</span></div>
          <div class="font-medium">${t.task}</div>
          <div><span class="priority-dot" style="background:${prioInfo.color}"></span> ${t.priority}</div>
          <div class="text-gray-500">${week.start.slice(5)}</div>
        </div>`;
      });
    });
  });
  return html;
}

function renderDayView(quarters) {
  let html = '<div class="overflow-x-auto">';
  quarters.forEach(qKey => {
    const q = GANTT_TASKS[qKey];
    if (!q) return;
    html += `<h2 class="text-lg font-bold text-blue-800 mt-4 mb-2">${q.name}</h2>`;
    
    q.weeks.forEach(week => {
      const tasks = filterTasks(week.tasks);
      if (tasks.length === 0) return;
      
      // Generate days for the week
      const startDate = new Date(week.start);
      const endDate = new Date(week.end);
      const days = [];
      for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
        days.push(new Date(d));
      }
      
      html += `<div class="mb-4"><div class="font-semibold text-sm mb-1">${week.week}: ${week.start} â†’ ${week.end}</div>`;
      html += `<div style="display:grid;grid-template-columns:repeat(${days.length},1fr);gap:2px">`;
      
      // Day headers
      days.forEach(d => {
        const dayName = ['CN','T2','T3','T4','T5','T6','T7'][d.getDay()];
        html += `<div class="day-cell bg-gray-100 font-semibold">${dayName}<br>${d.getDate()}/${d.getMonth()+1}</div>`;
      });
      
      // Tasks distributed across days
      days.forEach((d, i) => {
        const dayTasks = tasks.filter((t, ti) => ti % days.length === i);
        html += `<div class="day-cell">`;
        dayTasks.forEach(t => {
          const typeInfo = TASK_TYPES[t.type] || { color: '#64748b' };
          html += `<div class="day-task" style="background:${typeInfo.color}" title="${t.site}: ${t.task}">${t.site.slice(0,3)}</div>`;
        });
        html += `</div>`;
      });
      
      html += `</div></div>`;
    });
  });
  html += '</div>';
  return html;
}

function renderListView(quarters) {
  let html = '<table class="w-full text-xs"><thead class="bg-gray-100"><tr>';
  html += '<th class="p-2 text-left">Tuáº§n</th><th class="p-2 text-left">NgÃ y</th><th class="p-2 text-left">Website</th>';
  html += '<th class="p-2 text-left">Task</th><th class="p-2 text-left">Loáº¡i</th><th class="p-2 text-left">Priority</th>';
  html += '</tr></thead><tbody>';
  
  let count = 0;
  quarters.forEach(qKey => {
    const q = GANTT_TASKS[qKey];
    if (!q) return;
    
    q.weeks.forEach(week => {
      const tasks = filterTasks(week.tasks);
      tasks.forEach(t => {
        count++;
        const typeInfo = TASK_TYPES[t.type] || { color: '#64748b', label: t.type };
        const prioInfo = PRIORITIES[t.priority] || { color: '#64748b' };
        const bgClass = count % 2 === 0 ? 'bg-gray-50' : '';
        html += `<tr class="${bgClass} hover:bg-blue-50">
          <td class="p-2 font-medium">${week.week}</td>
          <td class="p-2">${week.start}</td>
          <td class="p-2"><span class="site-badge" style="background:${SITE_COLORS[t.site]}">${SITE_ICONS[t.site]} ${t.site}</span></td>
          <td class="p-2">${t.task}</td>
          <td class="p-2"><span class="type-badge" style="background:${typeInfo.color};color:#fff">${typeInfo.label}</span></td>
          <td class="p-2"><span class="priority-dot" style="background:${prioInfo.color}"></span> ${t.priority}</td>
        </tr>`;
      });
    });
  });
  
  html += '</tbody></table>';
  html += `<div class="text-center text-gray-500 mt-2">Tá»•ng: ${count} tasks</div>`;
  return html;
}

function render() {
  const quarters = currentQuarter === 'all' ? ['q1', 'q2', 'q3', 'q4'] : [currentQuarter];
  let html = '';
  
  if (currentView === 'week') {
    html = renderWeekView(quarters);
  } else if (currentView === 'day') {
    html = renderDayView(quarters);
  } else {
    html = renderListView(quarters);
  }
  
  document.getElementById('ganttContent').innerHTML = html;
}

function exportGanttExcel() {
  const wb = XLSX.utils.book_new();
  const data = [['QuÃ½', 'Tuáº§n', 'Start', 'End', 'Website', 'Task', 'Loáº¡i', 'Priority']];
  
  ['q1', 'q2', 'q3', 'q4'].forEach(qKey => {
    const q = GANTT_TASKS[qKey];
    q.weeks.forEach(week => {
      week.tasks.forEach(t => {
        data.push([q.name, week.week, week.start, week.end, t.site, t.task, t.type, t.priority]);
      });
    });
  });
  
  const ws = XLSX.utils.aoa_to_sheet(data);
  ws['!cols'] = [{wch:20},{wch:6},{wch:12},{wch:12},{wch:10},{wch:40},{wch:12},{wch:10}];
  XLSX.utils.book_append_sheet(wb, ws, 'Gantt_Tasks');
  XLSX.writeFile(wb, 'Gantt_Tasks_2026.xlsx');
  alert('âœ… Export thÃ nh cÃ´ng Gantt_Tasks_2026.xlsx!');
}

render();
</script>
</body>
</html>